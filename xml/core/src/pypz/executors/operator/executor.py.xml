<?xml-stylesheet type="text/xsl" href="../../../../../../mypy-html.xslt"?><mypy-report-file name="core\src\pypz\executors\operator\executor.py" module="core.src.pypz.executors.operator.executor"><line any_info="No Anys on this line!" content="# =============================================================================" number="1" precision="empty"/><line any_info="No Anys on this line!" content="# Copyright (c) 2024 by Laszlo Anka. All rights reserved." number="2" precision="empty"/><line any_info="No Anys on this line!" content="#" number="3" precision="empty"/><line any_info="No Anys on this line!" content="# Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);" number="4" precision="empty"/><line any_info="No Anys on this line!" content="# you may not use this file except in compliance with the License." number="5" precision="empty"/><line any_info="No Anys on this line!" content="# You may obtain a copy of the License at" number="6" precision="empty"/><line any_info="No Anys on this line!" content="#" number="7" precision="empty"/><line any_info="No Anys on this line!" content="#     http://www.apache.org/licenses/LICENSE-2.0" number="8" precision="empty"/><line any_info="No Anys on this line!" content="#" number="9" precision="empty"/><line any_info="No Anys on this line!" content="# Unless required by applicable law or agreed to in writing, software" number="10" precision="empty"/><line any_info="No Anys on this line!" content="# distributed under the License is distributed on an &quot;AS IS&quot; BASIS," number="11" precision="empty"/><line any_info="No Anys on this line!" content="# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied." number="12" precision="empty"/><line any_info="No Anys on this line!" content="# See the License for the specific language governing permissions and" number="13" precision="empty"/><line any_info="No Anys on this line!" content="# limitations under the License." number="14" precision="empty"/><line any_info="No Anys on this line!" content="# =============================================================================" number="15" precision="empty"/><line any_info="No Anys on this line!" content="import signal" number="16" precision="precise"/><line any_info="No Anys on this line!" content="import sys" number="17" precision="precise"/><line any_info="No Anys on this line!" content="import traceback" number="18" precision="precise"/><line any_info="No Anys on this line!" content="" number="19" precision="empty"/><line any_info="No Anys on this line!" content="from pypz.executors.commons import ExecutionMode" number="20" precision="any"/><line any_info="No Anys on this line!" content="from pypz.executors.commons import ExitCodes" number="21" precision="any"/><line any_info="No Anys on this line!" content="from pypz.core.commons.utils import SynchronizedReference, TemplateResolver" number="22" precision="any"/><line any_info="No Anys on this line!" content="from pypz.core.specs.operator import Operator" number="23" precision="any"/><line any_info="No Anys on this line!" content="from pypz.core.specs.plugin import ExtendedPlugin, Plugin" number="24" precision="any"/><line any_info="No Anys on this line!" content="from pypz.executors.operator.context import ExecutionContext" number="25" precision="any"/><line any_info="No Anys on this line!" content="from pypz.executors.operator.signals import BaseSignal, SignalNoOp, SignalKill, SignalServicesStart, SignalShutdown, \" number="26" precision="any"/><line any_info="No Anys on this line!" content="    SignalResourcesCreation, SignalResourcesDeletion, SignalError, SignalOperationInit, SignalServicesStop, \" number="27" precision="empty"/><line any_info="No Anys on this line!" content="    SignalOperationStart, SignalOperationStop" number="28" precision="empty"/><line any_info="No Anys on this line!" content="from pypz.executors.operator.states import State, StateEntry, StateKilled, StateOperationInit, StateOperationShutdown, \" number="29" precision="any"/><line any_info="No Anys on this line!" content="    StateOperationRunning, StateResourceCreation, StateResourceDeletion, StateServiceStart, StateServiceShutdown" number="30" precision="empty"/><line any_info="No Anys on this line!" content="from pypz.version import PROJECT_VERSION" number="31" precision="any"/><line any_info="No Anys on this line!" content="" number="32" precision="empty"/><line any_info="No Anys on this line!" content="" number="33" precision="empty"/><line any_info="No Anys on this line!" content="class OperatorExecutor:" number="34" precision="precise"/><line any_info="No Anys on this line!" content="    &quot;&quot;&quot;" number="35" precision="empty"/><line any_info="No Anys on this line!" content="    This class has the purpose of executing an Operator along with its nested" number="36" precision="empty"/><line any_info="No Anys on this line!" content="    plugins. The execution is based on a state machine, where each state" number="37" precision="empty"/><line any_info="No Anys on this line!" content="    is responsible to execute specific entities' corresponding methods." number="38" precision="empty"/><line any_info="No Anys on this line!" content="" number="39" precision="empty"/><line any_info="No Anys on this line!" content="    :param operator: the actual operator instance to execute" number="40" precision="empty"/><line any_info="No Anys on this line!" content="    :param handle_interrupts: if True, then the execution can be interrupted by system signals" number="41" precision="empty"/><line any_info="No Anys on this line!" content="    &quot;&quot;&quot;" number="42" precision="empty"/><line any_info="No Anys on this line!" content="" number="43" precision="empty"/><line any_info="Any Types on this line: &#10;Unimported (x1)" content="    def __init__(self, operator: Operator, handle_interrupts: bool = True):" number="44" precision="any"/><line any_info="No Anys on this line!" content="" number="45" precision="empty"/><line any_info="No Anys on this line!" content="        # Initializing shutdown hook and signal handling as early as possible to prevent" number="46" precision="empty"/><line any_info="No Anys on this line!" content="        # the case that the signal has been sent during startup, but missed by the executors" number="47" precision="empty"/><line any_info="No Anys on this line!" content="        if handle_interrupts:" number="48" precision="precise"/><line any_info="Any Types on this line: &#10;Unannotated (x3)" content="            signal.signal(signal.SIGTERM, self.interrupt)" number="49" precision="precise"/><line any_info="Any Types on this line: &#10;Unannotated (x3)" content="            signal.signal(signal.SIGINT, self.interrupt)" number="50" precision="precise"/><line any_info="No Anys on this line!" content="" number="51" precision="empty"/><line any_info="Any Types on this line: &#10;Unimported (x3)" content="        self.__operator: Operator = operator" number="52" precision="any"/><line any_info="No Anys on this line!" content="        &quot;&quot;&quot;" number="53" precision="empty"/><line any_info="No Anys on this line!" content="        The actual operator instance, which shall be processed by the state machine" number="54" precision="empty"/><line any_info="No Anys on this line!" content="        &quot;&quot;&quot;" number="55" precision="empty"/><line any_info="No Anys on this line!" content="" number="56" precision="empty"/><line any_info="Any Types on this line: &#10;Unimported (x2)" content="        self.__context: ExecutionContext | None = None" number="57" precision="imprecise"/><line any_info="No Anys on this line!" content="        &quot;&quot;&quot;" number="58" precision="empty"/><line any_info="No Anys on this line!" content="        The stored execution context for this executor" number="59" precision="empty"/><line any_info="No Anys on this line!" content="        &quot;&quot;&quot;" number="60" precision="empty"/><line any_info="No Anys on this line!" content="" number="61" precision="empty"/><line any_info="Any Types on this line: &#10;Unimported (x6)" content="        self.__priority_signal: SynchronizedReference[BaseSignal] = SynchronizedReference(SignalNoOp())" number="62" precision="any"/><line any_info="No Anys on this line!" content="        &quot;&quot;&quot;" number="63" precision="empty"/><line any_info="No Anys on this line!" content="        Reference to the priority signal." number="64" precision="empty"/><line any_info="No Anys on this line!" content="        Note that this atomic variable was necessary, because there might be functionality that attempts" number="65" precision="empty"/><line any_info="No Anys on this line!" content="        to change the current signal. Direct changing is not really a lucky choice if changing from a separate" number="66" precision="empty"/><line any_info="No Anys on this line!" content="        thread is allowed (e.g. from shutdown hook). Therefore all the external entities are allowed to change" number="67" precision="empty"/><line any_info="No Anys on this line!" content="        the priority signal" number="68" precision="empty"/><line any_info="No Anys on this line!" content="        &quot;&quot;&quot;" number="69" precision="empty"/><line any_info="No Anys on this line!" content="" number="70" precision="empty"/><line any_info="Any Types on this line: &#10;Unimported (x4)" content="        self.__is_running: SynchronizedReference[bool] = SynchronizedReference(False)" number="71" precision="any"/><line any_info="No Anys on this line!" content="        &quot;&quot;&quot;" number="72" precision="empty"/><line any_info="No Anys on this line!" content="        Flag that signalizes, whether the state machine is running" number="73" precision="empty"/><line any_info="No Anys on this line!" content="        &quot;&quot;&quot;" number="74" precision="empty"/><line any_info="No Anys on this line!" content="" number="75" precision="empty"/><line any_info="No Anys on this line!" content="        # ======= State declarations ========" number="76" precision="empty"/><line any_info="No Anys on this line!" content="" number="77" precision="empty"/><line any_info="Any Types on this line: &#10;Unimported (x2)" content="        self.__state_entry: State | None = None" number="78" precision="imprecise"/><line any_info="Any Types on this line: &#10;Unimported (x2)" content="        self.__state_killed: State | None = None" number="79" precision="imprecise"/><line any_info="Any Types on this line: &#10;Unimported (x2)" content="        self.__state_operation_init: State | None = None" number="80" precision="imprecise"/><line any_info="Any Types on this line: &#10;Unimported (x2)" content="        self.__state_operation_running: State | None = None" number="81" precision="imprecise"/><line any_info="Any Types on this line: &#10;Unimported (x2)" content="        self.__state_operation_shutdown: State | None = None" number="82" precision="imprecise"/><line any_info="Any Types on this line: &#10;Unimported (x2)" content="        self.__state_resource_creation: State | None = None" number="83" precision="imprecise"/><line any_info="Any Types on this line: &#10;Unimported (x2)" content="        self.__state_resource_deletion: State | None = None" number="84" precision="imprecise"/><line any_info="Any Types on this line: &#10;Unimported (x2)" content="        self.__state_service_start: State | None = None" number="85" precision="imprecise"/><line any_info="Any Types on this line: &#10;Unimported (x2)" content="        self.__state_service_shutdown: State | None = None" number="86" precision="imprecise"/><line any_info="No Anys on this line!" content="" number="87" precision="empty"/><line any_info="Any Types on this line: &#10;Unimported (x2)" content="        self.__current_state: State | None = None" number="88" precision="imprecise"/><line any_info="Any Types on this line: &#10;Unimported (x2)" content="        self.__current_signal: BaseSignal | None = None" number="89" precision="imprecise"/><line any_info="No Anys on this line!" content="" number="90" precision="empty"/><line any_info="No Anys on this line!" content="        # Parameter handling" number="91" precision="empty"/><line any_info="No Anys on this line!" content="        # ==================" number="92" precision="empty"/><line any_info="No Anys on this line!" content="" number="93" precision="empty"/><line any_info="No Anys on this line!" content="        # Resolve runtime templates as well for plugins" number="94" precision="empty"/><line any_info="Any Types on this line: &#10;Unimported (x9)" content="        for name, value in self.__operator.get_protected().get_parameters().items():" number="95" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x9)" content="            self.__operator.set_parameter(name, TemplateResolver(&quot;$(&quot;, &quot;)&quot;).resolve(value))" number="96" precision="any"/><line any_info="No Anys on this line!" content="" number="97" precision="empty"/><line any_info="Any Types on this line: &#10;Unimported (x8)" content="        for plugin in self.__operator.get_protected().get_nested_instances().values():" number="98" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x9)" content="            for name, value in plugin.get_protected().get_parameters().items():" number="99" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x9)" content="                plugin.set_parameter(name, TemplateResolver(&quot;$(&quot;, &quot;)&quot;).resolve(value))" number="100" precision="any"/><line any_info="No Anys on this line!" content="" number="101" precision="empty"/><line any_info="No Anys on this line!" content="        # This is the point, where required parameters shall be checked, before continue" number="102" precision="empty"/><line any_info="Any Types on this line: &#10;Unimported (x4)" content="        missing_required_parameters = self.__operator.get_missing_required_parameters()" number="103" precision="any"/><line any_info="No Anys on this line!" content="" number="104" precision="empty"/><line any_info="Any Types on this line: &#10;Unimported (x1)" content="        if 0 &lt; len(missing_required_parameters):" number="105" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x4)" content="            raise LookupError(f&quot;[{self.__operator.get_full_name()}] &quot;" number="106" precision="any"/><line any_info="No Anys on this line!" content="                              f&quot;Missing required parameters: {missing_required_parameters}&quot;)" number="107" precision="empty"/><line any_info="No Anys on this line!" content="" number="108" precision="empty"/><line any_info="No Anys on this line!" content="        # Mock instance checking" number="109" precision="empty"/><line any_info="No Anys on this line!" content="        # ======================" number="110" precision="empty"/><line any_info="No Anys on this line!" content="        # Mocked operators cannot be executed" number="111" precision="empty"/><line any_info="Any Types on this line: &#10;Unimported (x3)" content="        if &quot;mocked&quot; in operator.__class__.__dict__:" number="112" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x3)" content="            raise PermissionError(f&quot;[{operator.get_full_name()}] Mock operator cannot be executed&quot;)" number="113" precision="any"/><line any_info="No Anys on this line!" content="" number="114" precision="empty"/><line any_info="No Anys on this line!" content="        # If a non-mock operator has a mock plugin, then something went wrong" number="115" precision="empty"/><line any_info="Any Types on this line: &#10;Unimported (x8)" content="        for plugin in self.__operator.get_protected().get_nested_instances().values():" number="116" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x3)" content="            if &quot;mocked&quot; in plugin.__class__.__dict__:" number="117" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x3)" content="                raise PermissionError(f&quot;[{plugin.get_full_name()}] Mock plugin in regular operator&quot;)" number="118" precision="any"/><line any_info="No Anys on this line!" content="" number="119" precision="empty"/><line any_info="No Anys on this line!" content="    # ========= public methods ==========" number="120" precision="empty"/><line any_info="No Anys on this line!" content="" number="121" precision="empty"/><line any_info="No Anys on this line!" content="    def is_running(self):" number="122" precision="any"/><line any_info="Any Types on this line: &#10;Unannotated (x3)" content="        return self.__is_running.get()" number="123" precision="any"/><line any_info="No Anys on this line!" content="" number="124" precision="empty"/><line any_info="No Anys on this line!" content="    def get_current_state(self):" number="125" precision="any"/><line any_info="Any Types on this line: &#10;Unannotated (x1)" content="        return self.__current_state" number="126" precision="any"/><line any_info="No Anys on this line!" content="" number="127" precision="empty"/><line any_info="No Anys on this line!" content="    def get_current_signal(self):" number="128" precision="any"/><line any_info="Any Types on this line: &#10;Unannotated (x1)" content="        return self.__current_signal" number="129" precision="any"/><line any_info="No Anys on this line!" content="" number="130" precision="empty"/><line any_info="Any Types on this line: &#10;Unimported (x3)" content="    def execute(self, exec_mode: ExecutionMode = ExecutionMode.Standard) -&gt; int:" number="131" precision="any"/><line any_info="No Anys on this line!" content="        &quot;&quot;&quot;" number="132" precision="empty"/><line any_info="No Anys on this line!" content="        Initializes and triggers execution. Note that, since every time, if this method is" number="133" precision="empty"/><line any_info="No Anys on this line!" content="        called, the persisted state of the execution and of its context is re-initialized," number="134" precision="empty"/><line any_info="No Anys on this line!" content="        hence this method is idempotent." number="135" precision="empty"/><line any_info="No Anys on this line!" content="" number="136" precision="empty"/><line any_info="No Anys on this line!" content="        :param exec_mode: the run mode if the execution (refer to ExecutorRunMode)" number="137" precision="empty"/><line any_info="No Anys on this line!" content="        :return: exit code (refer to ExitCodes)" number="138" precision="empty"/><line any_info="No Anys on this line!" content="        &quot;&quot;&quot;" number="139" precision="empty"/><line any_info="No Anys on this line!" content="" number="140" precision="empty"/><line any_info="Any Types on this line: &#10;Unimported (x4)" content="        if ExecutionMode.Skip == exec_mode:" number="141" precision="any"/><line any_info="No Anys on this line!" content="            return 0" number="142" precision="precise"/><line any_info="No Anys on this line!" content="" number="143" precision="empty"/><line any_info="No Anys on this line!" content="        try:" number="144" precision="empty"/><line any_info="No Anys on this line!" content="            # ========= Initialize instances =========" number="145" precision="empty"/><line any_info="No Anys on this line!" content="" number="146" precision="empty"/><line any_info="Any Types on this line: &#10;Unimported (x2)" content="            self.__initialize(exec_mode)" number="147" precision="any"/><line any_info="No Anys on this line!" content="" number="148" precision="empty"/><line any_info="No Anys on this line!" content="            # ========= Start the state machine =========" number="149" precision="empty"/><line any_info="No Anys on this line!" content="" number="150" precision="empty"/><line any_info="No Anys on this line!" content="            try:" number="151" precision="empty"/><line any_info="Any Types on this line: &#10;Unimported (x6)" content="                self.__operator.get_logger().debug(f&quot;Version: {PROJECT_VERSION}&quot;)" number="152" precision="any"/><line any_info="No Anys on this line!" content="" number="153" precision="empty"/><line any_info="Any Types on this line: &#10;Unimported (x5)" content="                self.__operator.get_logger().debug(&quot;Starting state machine ...&quot;)" number="154" precision="any"/><line any_info="No Anys on this line!" content="" number="155" precision="empty"/><line any_info="Any Types on this line: &#10;Unimported (x7)" content="                self.__operator.get_logger().debug(&quot;Run mode: %s&quot;, exec_mode.name)" number="156" precision="any"/><line any_info="No Anys on this line!" content="" number="157" precision="empty"/><line any_info="Any Types on this line: &#10;Unimported (x3)" content="                self.__is_running.set(True)" number="158" precision="any"/><line any_info="No Anys on this line!" content="" number="159" precision="empty"/><line any_info="Any Types on this line: &#10;Unimported (x2)" content="                while not isinstance(self.__current_signal, SignalKill):" number="160" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x4)" content="                    self.__current_signal = self.__current_state.on_execute()" number="161" precision="any"/><line any_info="No Anys on this line!" content="" number="162" precision="empty"/><line any_info="Any Types on this line: &#10;Unimported (x4)" content="                    if not isinstance(self.__priority_signal.get(), SignalNoOp):" number="163" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x5)" content="                        self.__operator.get_logger().debug(&quot;Priority signal caught: %s&quot;," number="164" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x5)" content="                                                           self.__priority_signal.get().__class__.__name__)" number="165" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x4)" content="                        self.__current_signal = self.__priority_signal.get()" number="166" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x5)" content="                        self.__priority_signal.set(SignalNoOp())" number="167" precision="any"/><line any_info="No Anys on this line!" content="" number="168" precision="empty"/><line any_info="Any Types on this line: &#10;Unimported (x5)" content="                    self.__current_state = self.__current_state.on_signal_handling(self.__current_signal)" number="169" precision="any"/><line any_info="No Anys on this line!" content="" number="170" precision="empty"/><line any_info="No Anys on this line!" content="            except:  # noqa: E722" number="171" precision="empty"/><line any_info="Any Types on this line: &#10;Unimported (x5)" content="                self.__context.set_exit_code(ExitCodes.FatalError)" number="172" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x5)" content="                self.__operator.get_logger().error(traceback.format_exc())" number="173" precision="any"/><line any_info="No Anys on this line!" content="            finally:" number="174" precision="empty"/><line any_info="Any Types on this line: &#10;Unimported (x3)" content="                self.__is_running.set(False)" number="175" precision="any"/><line any_info="No Anys on this line!" content="" number="176" precision="empty"/><line any_info="Any Types on this line: &#10;Unimported (x5)" content="                self.__operator.get_logger().debug(&quot;Shutting down state machine ...&quot;)" number="177" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x3)" content="                self.__state_entry.shutdown()" number="178" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x3)" content="                self.__state_killed.shutdown()" number="179" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x3)" content="                self.__state_operation_init.shutdown()" number="180" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x3)" content="                self.__state_operation_shutdown.shutdown()" number="181" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x3)" content="                self.__state_operation_running.shutdown()" number="182" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x3)" content="                self.__state_resource_creation.shutdown()" number="183" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x3)" content="                self.__state_resource_deletion.shutdown()" number="184" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x3)" content="                self.__state_service_start.shutdown()" number="185" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x3)" content="                self.__state_service_shutdown.shutdown()" number="186" precision="any"/><line any_info="No Anys on this line!" content="" number="187" precision="empty"/><line any_info="No Anys on this line!" content="                try:" number="188" precision="empty"/><line any_info="Any Types on this line: &#10;Unimported (x3)" content="                    self.__context.for_each_plugin_objects_with_type(" number="189" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x1)" content="                        ExtendedPlugin, lambda plugin: plugin.get_protected().post_execution())" number="190" precision="any"/><line any_info="No Anys on this line!" content="                except:  # noqa: E722" number="191" precision="empty"/><line any_info="Any Types on this line: &#10;Unimported (x3)" content="                    self.__context.for_each_plugin_objects_with_type(" number="192" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x1)" content="                        ExtendedPlugin, lambda plugin: plugin.get_protected().on_error())" number="193" precision="any"/><line any_info="No Anys on this line!" content="                    raise" number="194" precision="empty"/><line any_info="No Anys on this line!" content="        except:  # noqa: E722" number="195" precision="empty"/><line any_info="No Anys on this line!" content="            # Catching exceptions not handled at this point" number="196" precision="empty"/><line any_info="No Anys on this line!" content="            traceback.print_exc(file=sys.stderr)" number="197" precision="precise"/><line any_info="Any Types on this line: &#10;Unimported (x5)" content="            self.__context.set_exit_code(ExitCodes.FatalError)" number="198" precision="any"/><line any_info="No Anys on this line!" content="" number="199" precision="empty"/><line any_info="Any Types on this line: &#10;Unimported (x6)" content="        if ExitCodes.NoError != self.__context.get_exit_code():" number="200" precision="any"/><line any_info="No Anys on this line!" content="            print(&quot;[ERROR] Error occurred during the execution. Use logger plugin for details.&quot;, file=sys.stderr)" number="201" precision="precise"/><line any_info="No Anys on this line!" content="" number="202" precision="empty"/><line any_info="Any Types on this line: &#10;Unimported (x4)" content="        return self.__context.get_exit_code().value" number="203" precision="any"/><line any_info="No Anys on this line!" content="" number="204" precision="empty"/><line any_info="No Anys on this line!" content="    # ========= private methods ==========" number="205" precision="empty"/><line any_info="No Anys on this line!" content="" number="206" precision="empty"/><line any_info="Any Types on this line: &#10;Unimported (x3)" content="    def __initialize(self, exec_mode: ExecutionMode = ExecutionMode.Standard) -&gt; None:" number="207" precision="any"/><line any_info="No Anys on this line!" content="        &quot;&quot;&quot;" number="208" precision="empty"/><line any_info="No Anys on this line!" content="        Initializes the execution states and context." number="209" precision="empty"/><line any_info="No Anys on this line!" content="" number="210" precision="empty"/><line any_info="No Anys on this line!" content="        :param exec_mode: the run mode if the execution (refer to ExecutorRunMode)" number="211" precision="empty"/><line any_info="No Anys on this line!" content="        &quot;&quot;&quot;" number="212" precision="empty"/><line any_info="No Anys on this line!" content="" number="213" precision="empty"/><line any_info="No Anys on this line!" content="        # ========= Initialize context =========" number="214" precision="empty"/><line any_info="No Anys on this line!" content="" number="215" precision="empty"/><line any_info="Any Types on this line: &#10;Unimported (x6)" content="        self.__context: ExecutionContext = ExecutionContext(self.__operator, exec_mode)" number="216" precision="any"/><line any_info="No Anys on this line!" content="" number="217" precision="empty"/><line any_info="No Anys on this line!" content="        try:" number="218" precision="empty"/><line any_info="No Anys on this line!" content="            # Addons shall be initialized as early as possible to cover the most part" number="219" precision="empty"/><line any_info="No Anys on this line!" content="            # of the execution" number="220" precision="empty"/><line any_info="Any Types on this line: &#10;Unimported (x3)" content="            self.__context.for_each_plugin_objects_with_type(" number="221" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x1)" content="                ExtendedPlugin, lambda plugin: plugin.get_protected().pre_execution())" number="222" precision="any"/><line any_info="No Anys on this line!" content="        except:  # noqa: E722" number="223" precision="empty"/><line any_info="Any Types on this line: &#10;Unimported (x4)" content="            self.__context.for_each_plugin_objects_with_type(ExtendedPlugin," number="224" precision="any"/><line any_info="No Anys on this line!" content="                                                             lambda plugin: plugin.get_protected().on_error())" number="225" precision="precise"/><line any_info="No Anys on this line!" content="            raise" number="226" precision="empty"/><line any_info="No Anys on this line!" content="" number="227" precision="empty"/><line any_info="No Anys on this line!" content="        # ========= Initialize state machine =========" number="228" precision="empty"/><line any_info="No Anys on this line!" content="" number="229" precision="empty"/><line any_info="No Anys on this line!" content="        # State transitions init" number="230" precision="empty"/><line any_info="No Anys on this line!" content="        # ======================" number="231" precision="empty"/><line any_info="No Anys on this line!" content="" number="232" precision="empty"/><line any_info="Any Types on this line: &#10;Unimported (x4)" content="        self.__state_entry = StateEntry(self.__context)" number="233" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x4)" content="        self.__state_killed = StateKilled(self.__context)" number="234" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x4)" content="        self.__state_operation_init = StateOperationInit(self.__context)" number="235" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x4)" content="        self.__state_operation_shutdown = StateOperationShutdown(self.__context)" number="236" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x4)" content="        self.__state_operation_running = StateOperationRunning(self.__context)" number="237" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x4)" content="        self.__state_resource_creation = StateResourceCreation(self.__context)" number="238" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x4)" content="        self.__state_resource_deletion = StateResourceDeletion(self.__context)" number="239" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x4)" content="        self.__state_service_start = StateServiceStart(self.__context)" number="240" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x4)" content="        self.__state_service_shutdown = StateServiceShutdown(self.__context)" number="241" precision="any"/><line any_info="No Anys on this line!" content="" number="242" precision="empty"/><line any_info="Any Types on this line: &#10;Unimported (x5)" content="        self.__state_entry.set_transition(SignalServicesStart, self.__state_service_start)" number="243" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x5)" content="        self.__state_entry.set_transition(SignalShutdown, self.__state_killed)" number="244" precision="any"/><line any_info="No Anys on this line!" content="" number="245" precision="empty"/><line any_info="Any Types on this line: &#10;Unimported (x5)" content="        self.__state_service_start.set_transition(SignalResourcesCreation, self.__state_resource_creation)" number="246" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x5)" content="        self.__state_service_start.set_transition(SignalResourcesDeletion, self.__state_resource_deletion)" number="247" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x5)" content="        self.__state_service_start.set_transition(SignalError, self.__state_service_shutdown)" number="248" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x5)" content="        self.__state_service_start.set_transition(SignalShutdown, self.__state_service_shutdown)" number="249" precision="any"/><line any_info="No Anys on this line!" content="" number="250" precision="empty"/><line any_info="Any Types on this line: &#10;Unimported (x5)" content="        self.__state_resource_creation.set_transition(SignalOperationInit, self.__state_operation_init)" number="251" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x5)" content="        self.__state_resource_creation.set_transition(SignalError, self.__state_resource_deletion)" number="252" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x5)" content="        self.__state_resource_creation.set_transition(SignalServicesStop, self.__state_service_shutdown)" number="253" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x5)" content="        self.__state_resource_creation.set_transition(SignalShutdown, self.__state_resource_deletion)" number="254" precision="any"/><line any_info="No Anys on this line!" content="" number="255" precision="empty"/><line any_info="Any Types on this line: &#10;Unimported (x5)" content="        self.__state_operation_init.set_transition(SignalOperationStart, self.__state_operation_running)" number="256" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x5)" content="        self.__state_operation_init.set_transition(SignalError, self.__state_operation_shutdown)" number="257" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x5)" content="        self.__state_operation_init.set_transition(SignalShutdown, self.__state_operation_shutdown)" number="258" precision="any"/><line any_info="No Anys on this line!" content="" number="259" precision="empty"/><line any_info="Any Types on this line: &#10;Unimported (x5)" content="        self.__state_operation_running.set_transition(SignalOperationStop, self.__state_operation_shutdown)" number="260" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x5)" content="        self.__state_operation_running.set_transition(SignalError, self.__state_operation_shutdown)" number="261" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x5)" content="        self.__state_operation_running.set_transition(SignalShutdown, self.__state_operation_shutdown)" number="262" precision="any"/><line any_info="No Anys on this line!" content="" number="263" precision="empty"/><line any_info="Any Types on this line: &#10;Unimported (x5)" content="        self.__state_operation_shutdown.set_transition(SignalResourcesDeletion, self.__state_resource_deletion)" number="264" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x5)" content="        self.__state_operation_shutdown.set_transition(SignalServicesStop, self.__state_service_shutdown)" number="265" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x5)" content="        self.__state_operation_shutdown.set_transition(SignalError, self.__state_resource_deletion)" number="266" precision="any"/><line any_info="No Anys on this line!" content="" number="267" precision="empty"/><line any_info="Any Types on this line: &#10;Unimported (x5)" content="        self.__state_resource_deletion.set_transition(SignalServicesStop, self.__state_service_shutdown)" number="268" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x5)" content="        self.__state_resource_deletion.set_transition(SignalError, self.__state_service_shutdown)" number="269" precision="any"/><line any_info="No Anys on this line!" content="" number="270" precision="empty"/><line any_info="Any Types on this line: &#10;Unimported (x5)" content="        self.__state_service_shutdown.set_transition(SignalError, self.__state_killed)" number="271" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x5)" content="        self.__state_service_shutdown.set_transition(SignalKill, self.__state_killed)" number="272" precision="any"/><line any_info="No Anys on this line!" content="" number="273" precision="empty"/><line any_info="Any Types on this line: &#10;Unimported (x2)" content="        self.__current_state = self.__state_entry" number="274" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x3)" content="        self.__current_signal = SignalNoOp()" number="275" precision="any"/><line any_info="No Anys on this line!" content="" number="276" precision="empty"/><line any_info="No Anys on this line!" content="    def interrupt(self, signal_number=None, current_stack=None):" number="277" precision="any"/><line any_info="Any Types on this line: &#10;Unannotated (x3)" content="        if self.__is_running.get():" number="278" precision="any"/><line any_info="Any Types on this line: &#10;Unannotated (x5)" content="            self.__operator.get_logger().debug(&quot;Processing interrupt signal ...&quot;)" number="279" precision="any"/><line any_info="No Anys on this line!" content="" number="280" precision="empty"/><line any_info="No Anys on this line!" content="            # Current state shutdown shall be called here to interrupt scheduling and cancel futures" number="281" precision="empty"/><line any_info="Any Types on this line: &#10;Unannotated (x3)" content="            self.__current_state.shutdown()" number="282" precision="any"/><line any_info="No Anys on this line!" content="" number="283" precision="empty"/><line any_info="No Anys on this line!" content="            # Invoking plugins' on_interrupt() method" number="284" precision="empty"/><line any_info="No Anys on this line!" content="            try:" number="285" precision="empty"/><line any_info="Any Types on this line: &#10;Unannotated (x3)" content="                self.__context.for_each_plugin_objects_with_type(" number="286" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x1)&#10;Unannotated (x5)" content="                    Plugin, lambda plugin: plugin.get_protected().on_interrupt(signal_number))" number="287" precision="any"/><line any_info="No Anys on this line!" content="            except:  # noqa: E722" number="288" precision="empty"/><line any_info="No Anys on this line!" content="                # Ignore exception to be able to proceed with the shutdown" number="289" precision="empty"/><line any_info="Any Types on this line: &#10;Unannotated (x1)" content="                traceback.print_exc(file=sys.stderr)" number="290" precision="any"/><line any_info="No Anys on this line!" content="                pass" number="291" precision="any"/><line any_info="No Anys on this line!" content="" number="292" precision="empty"/><line any_info="No Anys on this line!" content="            # Invoking operator's on_interrupt() method" number="293" precision="empty"/><line any_info="No Anys on this line!" content="            try:" number="294" precision="empty"/><line any_info="Any Types on this line: &#10;Unannotated (x6)" content="                self.__operator.get_protected().on_interrupt(signal_number)" number="295" precision="any"/><line any_info="No Anys on this line!" content="            except:  # noqa: E722" number="296" precision="empty"/><line any_info="No Anys on this line!" content="                # Ignore exception to be able to proceed with the shutdown" number="297" precision="empty"/><line any_info="Any Types on this line: &#10;Unannotated (x1)" content="                traceback.print_exc(file=sys.stderr)" number="298" precision="any"/><line any_info="No Anys on this line!" content="                pass" number="299" precision="any"/><line any_info="No Anys on this line!" content="" number="300" precision="empty"/><line any_info="Any Types on this line: &#10;Unannotated (x4)&#10;Unimported (x1)" content="            self.__context.set_exit_code(ExitCodes.SigTerm)" number="301" precision="any"/><line any_info="Any Types on this line: &#10;Unannotated (x4)&#10;Unimported (x1)" content="            self.__priority_signal.set(SignalShutdown())" number="302" precision="any"/></mypy-report-file>